<script>
    const statusData = {{ bestaande | tojson }};
    const vandaag = new Date();
    const volgendeMaandag = new Date(vandaag);
    volgendeMaandag.setDate(vandaag.getDate() + (8 - vandaag.getDay()));

    flatpickr("#datums", {
        mode: "multiple",
        dateFormat: "Y-m-d",
        minDate: volgendeMaandag,
        onDayCreate: function(dObj, dStr, fp, dayElem) {
            if (!dayElem.dateObj) return;
            const date = dayElem.dateObj.toISOString().split('T')[0];
            const status = statusData[date];
            if (status === 'open') dayElem.classList.add('status-pending');
            else if (status === 'goedgekeurd') dayElem.classList.add('status-goedgekeurd');
            else if (status === 'afgekeurd') dayElem.classList.add('status-afgekeurd');
        },
        onChange: function(selectedDates, dateStr, instance) {
            const cleaned = selectedDates.filter(d => {
                const date = d.toISOString().split('T')[0];
                return !statusData[date];
            });
            if (cleaned.length !== selectedDates.length) {
                instance.setDate(cleaned, true); // vervangt met alleen geldige
            }
        },
        locale: {
            firstDayOfWeek: 1
        }
    });
</script>
